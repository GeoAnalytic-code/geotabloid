
{% extends "base.html" %}

{% block css %}
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
  integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
  crossorigin=""/>
  <style>
      body {
          padding: 0;
          margin: 0;
      }
      html, body, .container /*, and all other map parent selectors*/ {
        height: 100%;
        overflow: hidden;
        width: 100%;
      }
      #map {
        width: auto;
        height: 100%;
      }
  </style>
{% endblock css %}


{% block content %}
<div id="map"></div>
{% endblock %}

{% block javascript %}
  <script src="//code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
          integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
          crossorigin="anonymous"></script>
  <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
        integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
        crossorigin=""></script>
  <script>
  {#var osmTiles = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {#}
  {#  attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',#}
  {#  maxZoom: 19,#}
  {#  });#}
  var osmTiles = {{ themap.tilelayer.js_create }}
  var lon = {{ themap.center.x }};
  var lat = {{ themap.center.y }};
  var zoom = {{ themap.zoom }};
  var map, layer;
  var circle = L.circleMarker([lat, lon], {
    color: 'red',
    fillColor: '#f03',
    fillOpacity: 0.5,
    radius: 10
  });

  function onEachFeature(feature, layer) {
      // does this feature have a property named popupContent?
      if (feature.properties && feature.properties.popupContent) {
          layer.bindPopup(feature.properties.popupContent);
      }
  }

    /* create the map  */
  map = L.map('map').setView([lat, lon], zoom)
  osmTiles.addTo(map);

    /* get the geoJson for the selected tracks */
  $.getJSON('{{ themap.track_json }}', function(data) {
    geojsont = L.geoJson(data).addTo(map);
    {#map.fitBounds(geojson.getBounds());#}
  });

    /* get the geoJson for the selected images */
  var geojsonMarkerOptions = {
    radius: 8,
    fillColor: "#ff7800",
    color: "#000",
    weight: 1,
    opacity: 1,
    fillOpacity: 0.8
  };

  $.getJSON('{{ themap.image_json }}', function(data) {
    geojsoni = L.geoJson(data, {
    pointToLayer: function (feature, latlng) {
      return L.circleMarker(latlng, geojsonMarkerOptions);
    }
    }).addTo(map);
  });
  </script>
{% endblock javascript %}

